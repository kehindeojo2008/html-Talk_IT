<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>2048 Classic</title>
    <style>
        body {
            background-color: #faf8ef;
            color: #776e65;
            font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent bounce scrolling on mobile */
        }

        .header {
            width: 90vw;
            max-width: 320px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 40px;
            margin: 0;
            color: #776e65;
        }

        .score-container {
            background: #bbada0;
            padding: 5px 15px;
            border-radius: 5px;
            color: white;
            text-align: center;
        }
        .score-label {
            font-size: 12px;
            text-transform: uppercase;
        }
        .score-val {
            font-size: 20px;
            font-weight: bold;
        }

        #game-board {
            width: 320px;
            height: 320px;
            background-color: #bbada0;
            border-radius: 6px;
            position: relative;
            padding: 10px;
            box-sizing: border-box;
            touch-action: none; /* Crucial for mobile: prevents browser from handling swipes */
        }

        /* Responsive scaling for small phones */
        @media (max-width: 350px) {
            #game-board {
                width: 280px;
                height: 280px;
            }
            .grid-cell, .tile {
                width: 55px !important;
                height: 55px !important;
            }
            /* Adjust tile positioning logic would be needed here for perfect fit, 
               but 320px usually fits most modern phones. */
        }

        .grid-cell {
            width: 65px;
            height: 65px;
            background-color: rgba(238, 228, 218, 0.35);
            border-radius: 3px;
            position: absolute;
        }

        .tile {
            width: 65px;
            height: 65px;
            border-radius: 3px;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            font-weight: bold;
            transition: all 0.1s ease-in-out;
            z-index: 10;
        }

        @keyframes pop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .tile-new { animation: pop 0.2s ease-in; }

        /* TILE COLORS */
        .tile-2 { background: #eee4da; color: #776e65; }
        .tile-4 { background: #ede0c8; color: #776e65; }
        .tile-8 { background: #f2b179; color: #f9f6f2; }
        .tile-16 { background: #f59563; color: #f9f6f2; }
        .tile-32 { background: #f67c5f; color: #f9f6f2; }
        .tile-64 { background: #f65e3b; color: #f9f6f2; }
        .tile-128 { background: #edcf72; color: #f9f6f2; font-size: 24px; }
        .tile-256 { background: #edcc61; color: #f9f6f2; font-size: 24px; }
        .tile-512 { background: #edc850; color: #f9f6f2; font-size: 24px; }
        .tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 18px; }
        .tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 18px; }

        .overlay {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(238, 228, 218, 0.73);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            text-align: center;
            border-radius: 6px;
        }
        button {
            background: #8f7a66;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>2048</h1>
        <div class="score-container">
            <div class="score-label">Score</div>
            <div class="score-val" id="score">0</div>
        </div>
    </div>

    <div id="game-board">
        <div class="overlay" id="game-over">
            <h2 style="font-size: 40px; color: #776e65">Game Over!</h2>
            <button onclick="restartGame()">Try Again</button>
        </div>
    </div>

    <p style="font-size: 14px; margin-top: 20px; text-align: center;">
        <strong>Arrows</strong> for PC <br> <strong>Swipe</strong> for Mobile
    </p>

    <script>
        const boardElement = document.getElementById("game-board");
        const scoreElement = document.getElementById("score");
        const overlay = document.getElementById("game-over");

        let board = [];
        let score = 0;
        const size = 4;

        // Init Background
        function init() {
            for (let i = 0; i < 16; i++) {
                let cell = document.createElement("div");
                cell.className = "grid-cell";
                let r = Math.floor(i / size);
                let c = i % size;
                cell.style.top = 10 + r * 75 + "px";
                cell.style.left = 10 + c * 75 + "px";
                boardElement.appendChild(cell);
            }
            restartGame();
        }

        function restartGame() {
            board = Array(size).fill().map(() => Array(size).fill(0));
            score = 0;
            scoreElement.innerText = "0";
            overlay.style.display = "none";
            spawnTile();
            spawnTile();
            drawTiles();
        }

        function spawnTile() {
            let emptyCells = [];
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (board[r][c] === 0) emptyCells.push({ r, c });
                }
            }
            if (emptyCells.length > 0) {
                let rand = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                board[rand.r][rand.c] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        function slideRow(row) {
            let arr = row.filter((val) => val);
            for (let i = 0; i < arr.length - 1; i++) {
                if (arr[i] === arr[i + 1]) {
                    arr[i] *= 2;
                    score += arr[i];
                    arr[i + 1] = 0;
                }
            }
            arr = arr.filter((val) => val);
            while (arr.length < size) arr.push(0);
            return arr;
        }

        function move(direction) {
            let oldBoard = JSON.stringify(board);

            if (direction === "Left" || direction === "Right") {
                for (let r = 0; r < size; r++) {
                    let row = board[r];
                    if (direction === "Right") row.reverse();
                    let newRow = slideRow(row);
                    if (direction === "Right") newRow.reverse();
                    board[r] = newRow;
                }
            } else if (direction === "Up" || direction === "Down") {
                for (let c = 0; c < size; c++) {
                    let col = [board[0][c], board[1][c], board[2][c], board[3][c]];
                    if (direction === "Down") col.reverse();
                    let newCol = slideRow(col);
                    if (direction === "Down") newCol.reverse();
                    for (let r = 0; r < size; r++) board[r][c] = newCol[r];
                }
            }

            scoreElement.innerText = score;
            if (oldBoard !== JSON.stringify(board)) {
                spawnTile();
                drawTiles();
                checkGameOver();
            }
        }

        function drawTiles() {
            document.querySelectorAll(".tile").forEach((t) => t.remove());
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    let val = board[r][c];
                    if (val > 0) {
                        let tile = document.createElement("div");
                        tile.classList.add("tile", `tile-${val}`);
                        tile.innerText = val;
                        tile.style.top = 10 + r * 75 + "px";
                        tile.style.left = 10 + c * 75 + "px";
                        boardElement.appendChild(tile);
                    }
                }
            }
        }

        function checkGameOver() {
            for (let r = 0; r < size; r++)
                for (let c = 0; c < size; c++) if (board[r][c] === 0) return;
            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    if (c < size - 1 && board[r][c] === board[r][c + 1]) return;
                    if (r < size - 1 && board[r][c] === board[r + 1][c]) return;
                }
            }
            overlay.style.display = "flex";
        }

        // --- CONTROLS ---

        // Keyboard (PC)
        document.addEventListener("keydown", (e) => {
            if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(e.key)) {
                e.preventDefault();
                move(e.key.replace("Arrow", ""));
            }
        });

        // Touch (Mobile)
        let touchStartX = 0;
        let touchStartY = 0;

        boardElement.addEventListener("touchstart", (e) => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: true});

        boardElement.addEventListener("touchend", (e) => {
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;
            handleSwipe(touchStartX, touchStartY, touchEndX, touchEndY);
        }, {passive: true});

        function handleSwipe(x1, y1, x2, y2) {
            let dx = x2 - x1;
            let dy = y2 - y1;
            // Min threshold of 30px to trigger move
            if (Math.abs(dx) > Math.abs(dy)) {
                if (Math.abs(dx) > 30) move(dx > 0 ? "Right" : "Left");
            } else {
                if (Math.abs(dy) > 30) move(dy > 0 ? "Down" : "Up");
            }
        }

        init();
    </script>
</body>
</html>